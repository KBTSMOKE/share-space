<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>共享空间</title>
    <style>
        /* 保留你原来的样式 */
        body { font-family: Arial; margin: 0; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: auto; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .section { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        @media (max-width: 768px) { .container { grid-template-columns: 1fr; } }
        .photo-item img { width: 100%; height: 150px; object-fit: cover; border-radius: 5px; }
        .todo-item { display: flex; align-items: center; gap: 10px; padding: 5px 0; }
        .todo-item.completed { text-decoration: line-through; opacity: 0.6; }
    </style>
</head>
<body>
    <div class="container">
        <div class="section">
            <h2>📸 共享照片墙</h2>
            <input type="file" id="photoInput" accept="image/*" style="display:none" multiple>
            <button onclick="photoInput.click()">上传照片</button>
            <div id="photoGallery" style="display:grid; grid-template-columns: repeat(auto-fill,minmax(150px,1fr)); gap:10px; margin-top:15px;"></div>
        </div>

        <div class="section">
            <h2>📝 共享日记</h2>
            <textarea id="diaryContent" placeholder="写下今天的心情..." rows="4" style="width:100%"></textarea>
            <button onclick="saveDiary()">发布日记</button>
            <div id="diaryList" style="margin-top:15px;"></div>
        </div>

        <div class="section">
            <h2>✅ 共享待办</h2>
            <input type="text" id="todoInput" placeholder="添加待办事项..." style="width:70%; padding:5px">
            <button onclick="addTodo()">添加</button>
            <div id="todoList"></div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

    <script>
        // 🔧 把这里改成你的数据库URL
        const firebaseConfig = {
            databaseURL: "https://YOUR-PROJECT-ID-default-rtdb.asia-southeast1.firebasedatabase.app/"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // 实时监听照片
        db.ref("photos").on("value", snap => {
            const gallery = document.getElementById("photoGallery");
            gallery.innerHTML = "";
            snap.forEach(child => {
                const p = child.val();
                gallery.innerHTML += `<div class="photo-item">
                    <img src="${p.src}">
                    <button onclick="deletePhoto('${child.key}')">×</button>
                </div>`;
            });
        });

        // 实时监听日记
        db.ref("diaries").on("value", snap => {
            const list = document.getElementById("diaryList");
            list.innerHTML = "";
            snap.forEach(child => {
                const d = child.val();
                list.innerHTML += `<div style="border-left:3px solid #667eea; padding:8px; margin:5px 0;">
                    <small>${d.date}</small><br>${d.content}
                </div>`;
            });
        });

        // 实时监听待办
        db.ref("todos").on("value", snap => {
            const list = document.getElementById("todoList");
            list.innerHTML = "";
            snap.forEach(child => {
                const t = child.val();
                list.innerHTML += `<div class="todo-item ${t.completed?'completed':''}">
                    <input type="checkbox" ${t.completed?'checked':''} onchange="toggleTodo('${child.key}', this.checked)">
                    ${t.text}
                    <button onclick="deleteTodo('${child.key}')">×</button>
                </div>`;
            });
        });

        // 上传照片
        function handlePhoto(e) {
            for (let file of e.target.files) {
                const reader = new FileReader();
                reader.onload = ev => {
                    db.ref("photos").push({ src: ev.target.result });
                };
                reader.readAsDataURL(file);
            }
        }
        document.getElementById("photoInput").addEventListener("change", handlePhoto);
        function deletePhoto(id) { db.ref("photos").child(id).remove(); }

        // 发布日记
        function saveDiary() {
            const txt = document.getElementById("diaryContent").value.trim();
            if (!txt) return alert("写点什么吧");
            db.ref("diaries").push({ content: txt, date: new Date().toLocaleString("zh-CN") });
            document.getElementById("diaryContent").value = "";
        }

        // 添加待办
        function addTodo() {
            const txt = document.getElementById("todoInput").value.trim();
            if (!txt) return alert("输入内容");
            db.ref("todos").push({ text: txt, completed: false });
            document.getElementById("todoInput").value = "";
        }
        function toggleTodo(id, completed) {
            db.ref("todos").child(id).update({ completed });
        }
        function deleteTodo(id) {
            db.ref("todos").child(id).remove();
        }
    </script>
</body>
</html>
